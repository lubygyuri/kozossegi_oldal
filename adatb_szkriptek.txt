CREATE TABLE felhasznalo (
    EMAIL VARCHAR2(60) PRIMARY KEY NOT NULL,
    JELSZO CHAR(200) NOT NULL,
    VEZETEKNEV VARCHAR2(60) NOT NULL,
    KERESZTNEV VARCHAR2(60) NOT NULL,
    SZULETESI_DATUM DATE NOT NULL,
    NEME VARCHAR2(10) NOT NULL,
    ISKOLA VARCHAR2(100),
    MUNKAHELY VARCHAR2(100),
    CSATLAKOZAS_DATUMA DATE NOT NULL,
    PROFILKEP VARCHAR2(255)
);

CREATE TABLE fenykep_album (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    NEV VARCHAR2(100),
    TELJES_MERET NUMBER,
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL)
);

CREATE TABLE fenykepek (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    KEP VARCHAR2(200) NOT NULL,
    MERET NUMBER NOT NULL,
    FENYKEP_ALBUM_AZONOSITO NUMBER REFERENCES fenykep_album (AZONOSITO) NOT NULL
);

CREATE TABLE ismeros (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    STATUSZ SMALLINT, 
    FELHASZNALO1 VARCHAR2(60) REFERENCES felhasznalo (EMAIL),
    FELHASZNALO2 VARCHAR2(60) REFERENCES felhasznalo (EMAIL)
);

CREATE TABLE bejegyzes (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    UZENET VARCHAR2(2000) NOT NULL,
    LETREHOZAS_IDEJE TIMESTAMP NOT NULL,
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    KEP VARCHAR2(255),
    LIKES NUMBER DEFAULT 0 NOT NULL 
);

CREATE TABLE bejegyzes_like (
    BEJEGYZES_AZONOSITO NUMBER NOT NULL REFERENCES bejegyzes (AZONOSITO),
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    PRIMARY KEY (BEJEGYZES_AZONOSITO, FELHASZNALO_AZONOSITO)
);

CREATE TABLE komment (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    UZENET VARCHAR2(1000) NOT NULL,
    LETREHOZAS_DATUMA TIMESTAMP NOT NULL,
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    BEJEGYZES_AZONOSITO NUMBER NOT NULL REFERENCES bejegyzes (AZONOSITO)
);

CREATE TABLE komment_like (
    KOMMENT_AZONOSITO NUMBER NOT NULL REFERENCES komment (AZONOSITO),
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    PRIMARY KEY (KOMMENT_AZONOSITO, FELHASZNALO_AZONOSITO)
);

CREATE TABLE klub (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    NEV VARCHAR2(100),
    LEIRAS VARCHAR2(1000),
    LATHATOSAG SMALLINT DEFAULT 0,
    LETREHOZAS_DATUMA DATE NOT NULL,
    ADMIN_FELHASZNALO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL)
);

CREATE TABLE klub_tagok (
    KLUB_AZONOSITO NUMBER NOT NULL REFERENCES klub (AZONOSITO),
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    PRIMARY KEY (KLUB_AZONOSITO, FELHASZNALO_AZONOSITO)
);

CREATE TABLE csoport (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    NEV VARCHAR2(30),
    ADMIN_FELHASZNALO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL)
);

CREATE TABLE csoport_tagok (
    CSOPORT_AZONOSITO NUMBER NOT NULL REFERENCES csoport (AZONOSITO),
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    PRIMARY KEY (CSOPORT_AZONOSITO, FELHASZNALO_AZONOSITO)
);

CREATE TABLE uzenet (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    UZENET VARCHAR2(1000) NOT NULL,
    KULDES_IDEJE TIMESTAMP NOT NULL,
    STATUSZ SMALLINT DEFAULT 0,
    KULDO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    FOGADO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    KEP VARCHAR2(255)
);

CREATE TABLE csoport_uzenet (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    UZENET VARCHAR2(1000) NOT NULL,
    KULDES_IDEJE TIMESTAMP NOT NULL,
    STATUSZ SMALLINT DEFAULT 0,
    KULDO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    CSOPORT_AZONOSITO NUMBER NOT NULL REFERENCES csoport (AZONOSITO)
);

CREATE TABLE klub_bejegyzes (
    AZONOSITO NUMBER PRIMARY KEY NOT NULL,
    UZENET VARCHAR2(2000) NOT NULL, 
    LETREHOZAS_IDEJE DATE NOT NULL,
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    KLUB_AZONOSITO NUMBER NOT NULL REFERENCES klub (AZONOSITO),
    KEP VARCHAR2(255)
);

CREATE TABLE klub_bejegyzes_like (
    KLUB_BEJEGYZES_AZONOSITO NUMBER NOT NULL REFERENCES klub_bejegyzes (AZONOSITO),
    FELHASZNALO_AZONOSITO VARCHAR2(60) NOT NULL REFERENCES felhasznalo (EMAIL),
    PRIMARY KEY (KLUB_BEJEGYZES_AZONOSITO, FELHASZNALO_AZONOSITO)
);

CREATE OR REPLACE TRIGGER BEJEGYZES_FELVETEL
BEFORE INSERT ON BEJEGYZES
FOR EACH ROW
  WHEN (new.AZONOSITO IS NULL)
BEGIN
  :new.AZONOSITO := BEJEGYZES_SEQ.NEXTVAL;
END;

CREATE SEQUENCE BEJEGYZES_SEQ 
  START WITH 1 
  INCREMENT BY 1;